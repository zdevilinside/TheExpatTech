{{ define "main" }}
  <p>DEBUG: project override section.html is active</p>
  {{ block "content" . }}{{ end }}
{{ end }}

{{- define "title" -}}
  {{- .Params.Title | default (T .Section) | default .Section | dict "Some" | T "allSome" }} - {{ .Site.Title -}}
{{- end -}}

{{- define "content" -}}
  <div class="page archive">
    <!-- Section heading -->
    <h2 class="single-title animate__animated animate__pulse animate__faster">
      {{- .Params.Title | default (T .Section) | default .Section | dict "Some" | T "allSome" -}}
    </h2>

    <!-- Debug: show what Hugo thinks belongs to this section -->
    <ul>
    {{ range .RegularPagesRecursive }}
      <li>{{ .File.Path }} — {{ .Title }} — type={{ .Type }} section={{ .Section }}</li>
    {{ end }}
    </ul>

    <!-- Custom taxonomy grid -->
    <div class="taxonomy-grid">
      {{ $pages := .RegularPagesRecursive }}
      {{ $sorted := $pages.ByDate.Reverse }}
      {{ $paginator := .Paginate $sorted }}
      {{ range $paginator.Pages }}
        <article class="taxonomy-card">
          {{ $img := .Resources.GetMatch .Params.image }}
          {{ if $img }}
            {{ $thumb := $img.Fill "400x250 center" }}
            <div class="thumb">
              <a href="{{ .RelPermalink }}">
                <img src="{{ $thumb.RelPermalink }}" alt="{{ .Title }}">
              </a>
            </div>
          {{ else if .Params.image }}
            <div class="thumb">
              <a href="{{ .RelPermalink }}">
                <img src="{{ .Params.image | relURL }}" alt="{{ .Title }}">
              </a>
            </div>
          {{ else }}
            <div class="thumb">
              <a href="{{ .RelPermalink }}">
                <img src="/images/default-thumb.jpg" alt="Default thumbnail">
              </a>
            </div>
          {{ end }}
          <h2><a href="{{ .RelPermalink }}">{{ .Title }}</a></h2>
          {{ with .Params.description }}
            <p>{{ . }}</p>
          {{ end }}
        </article>
      {{ end }}
    </div>

    <!-- Optional paginator -->
    {{ partial "paginator.html" . }}
  </div>
{{- end -}}
